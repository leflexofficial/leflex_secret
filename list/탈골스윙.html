<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>탈골스윙 대시보드</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .dashboard-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    table {
      border-collapse: collapse;
      font-size: 14px;
      min-width: 400px;
      /* table-layout: fixed; 고정 레이아웃 */

    }

    th, td {
      border: 1px solid #aaa;
      padding: 6px 10px;
      text-align: center;
      height: 20px;       /* 행 높이 고정 */
      line-height: 20px;  /* 행 내부 텍스트도 가운데 정렬 유지 */
      box-sizing: border-box;
    }

    th {
      background: #f0f0f0;
    }

    th.vat {
      background: #fff4e0;
      color: #d14300;
      font-weight: bold;
    }

    td.numeric {
      text-align: right;
    }

    .detail-table {
      margin-bottom: 20px;
    }

    .product-title {
      font-weight: bold;
      margin: 4px 0 5px;
    }
  </style>
</head>
<body>
  <h1>탈골스윙 대시보드</h1>

  <label for="monthSelect">월 선택:</label>
  <select id="monthSelect"></select>

  <div class="dashboard-container">
    <div class="summary-table">
      <table id="summaryTable">
      <thead>
        <tr>
          <th colspan="4" style="background:#f8f8f8; border: 1px solid #aaa;">LEFLEX 할인판매 현황</th>
          <th style="background:#fff4e0; color:#d14300; border: 1px solid #aaa;">VAT포함</th>
        </tr>
        <tr>
          <th>날짜</th>
          <th>주문수</th>
          <th>환불수</th>
          <th>판매수</th>
          <th>판매합계</th>
        </tr>
      </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="detail-tables" id="detailTables"></div>
  </div>

  <script src="../js/data.js"></script>
  <script>
    const youtuber = "탈골스윙";

    const monthSelect = document.getElementById("monthSelect");
    const summaryBody = document.querySelector("#summaryTable tbody");
    const detailTablesContainer = document.getElementById("detailTables");

    const months = [...new Set(salesData
      .filter(r => r.youtuber === youtuber)
      .map(r => r.month))].sort();

    months.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      monthSelect.appendChild(opt);
    });

    monthSelect.addEventListener("change", renderDashboard);

    function renderDashboard() {
      const selectedMonth = monthSelect.value;
      const filtered = salesData.filter(r => r.youtuber === youtuber && r.month === selectedMonth);

      renderSummaryTable(filtered);
      renderDetailTables(filtered);
    }

    function renderSummaryTable(rows) {
      summaryBody.innerHTML = "";

      const grouped = rows.reduce((acc, row) => {
        if (!acc[row.date]) {
          acc[row.date] = { date: row.date, order: 0, refund: 0, qty: 0, amount: 0 };
        }
        acc[row.date].order += row.order_count;
        acc[row.date].refund += row.refund_count;
        acc[row.date].qty += row.sale_qty;
        acc[row.date].amount += row.sale_amount;
        return acc;
      }, {});

      Object.values(grouped).forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.date}</td>
          <td class="numeric">${r.order.toLocaleString()}</td>
          <td class="numeric">${r.refund.toLocaleString()}</td>
          <td class="numeric">${r.qty.toLocaleString()}</td>
          <td class="numeric">${r.amount.toLocaleString()}</td>
        `;
        summaryBody.appendChild(tr);
      });
    }

    function renderDetailTables(rows) {
      detailTablesContainer.innerHTML = "";

      const products = [...new Set(rows.map(r => r.product))];

      products.forEach(product => {
        const productRows = rows.filter(r => r.product === product);

        const div = document.createElement("div");
        div.className = "detail-table";

        const title = document.createElement("div");
        title.className = "product-title";
        title.innerText = `[판매 세부] ${product} / 판매가: 13,200원 (VAT 포함)`;
        div.appendChild(title);

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr>
              <th>주문수</th>
              <th>환불수</th>
              <th>판매수</th>
              <th>판매합계</th>
            </tr>
          </thead>
          <tbody>
            ${productRows.map(r => `
              <tr>
                <td class="numeric">${r.order_count.toLocaleString()}</td>
                <td class="numeric">${r.refund_count.toLocaleString()}</td>
                <td class="numeric">${r.sale_qty.toLocaleString()}</td>
                <td class="numeric">${r.sale_amount.toLocaleString()}</td>
              </tr>
            `).join("")}
          </tbody>
        `;
        div.appendChild(table);

        detailTablesContainer.appendChild(div);
      });
    }

    // 초기 로딩 시 첫 월 선택
    if (months.length > 0) {
      monthSelect.value = months[0];
      renderDashboard();
    }
  </script>
</body>
</html>
